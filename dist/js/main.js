(()=>{"use strict";const e=()=>document.querySelector("table").insertAdjacentHTML("afterend",'<p style="width:400px;margin: 0 auto;">Произошла ошибка, данных нет!</p>'),t=e=>{const t=document.getElementById("table-body");t.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`<tr data-key="${e.id}">\n       <th scope="row">${e.id}</th>\n       <td>${e.name}</td>\n       <td>${e.email}</td>\n       <td>${e.children?"Есть":"Нет"}</td>\n       <td>\n         <div class="form-check form-switch">\n           <input class="form-check-input" type="checkbox" role="switch" id="form-children" ${e.permission?"checked":""}>\n         </div>\n       </td>\n       <td>\n         <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">\n           <button type="button" class="btn btn-warning">\n             <i class="bi-pencil-square"></i>\n           </button>\n           <button type="button" class="btn btn-danger">\n             <i class="bi-person-x"></i>\n           </button>\n         </div>\n       </td>\n     </tr>`)}))};window.userService=new class{async usersGet(t=""){try{const s=await fetch(`http://localhost:3004/users${t}`);if(s.ok)return await s.json();throw e()}catch(e){e()}}async usersSend(t,s,r=""){try{const n=await fetch(`http://localhost:3004/users${r}`,{method:t,headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(s)});if(n.ok)return await n.json();throw e()}catch(e){e()}}addUser(e){return this.usersSend("POST",e)}removeUser(e){return this.usersSend("DELETE",[],`/${e}`)}changePermission(e,t){return this.usersSend("PATCH",t,`/${e}`)}editUser(e,t){return this.usersSend("PUT",t,`/${e}`)}filterUsers(e){return this.usersGet(e)}sortUsers(e){return this.usersGet(e)}searchUsers(e){return this.usersGet(e)}},userService.usersGet().then((e=>t(e))),(()=>{const s=document.querySelector("form"),r=document.getElementById("form-name"),n=document.getElementById("form-email"),c=document.getElementById("form-children"),i=document.getElementById("search-input");s.addEventListener("submit",(d=>{if(d.preventDefault(),!s.dataset.edit){const d={name:`${r.value}`,email:`${n.value}`,children:c.checked,permisson:!1};userService.addUser(d).then((()=>{userService.usersGet().then((e=>t(e))).catch((()=>e()))})),s.reset(),i.value=""}}))})(),document.getElementById("table-body").addEventListener("click",(e=>{if(e.target.closest(".btn-danger")){const s=e.target.closest("tr");userService.removeUser(s.dataset.key).then((()=>{userService.usersGet().then((e=>t(e)))}))}})),document.getElementById("table-body").addEventListener("click",(e=>{if(e.target.closest(".form-check-input")){const s=e.target.closest("tr"),r=s.querySelector(".form-check-input");userService.changePermission(s.dataset.key,{permission:r.checked}).then((()=>{userService.usersGet().then((e=>t(e)))}))}})),(()=>{const e=document.getElementById("table-body"),s=document.querySelector("form"),r=document.getElementById("form-name"),n=document.getElementById("form-email"),c=document.getElementById("form-children"),i=document.getElementById("search-input");let d;e.addEventListener("click",(e=>{if(e.target.closest(".btn-warning")){console.log(1);const t=e.target.closest("tr");userService.usersGet(`/${t.dataset.key}`).then((e=>{r.value=e.name,n.value=e.email,c.checked=e.children,d=e.permission,s.dataset.edit=`${t.dataset.key}`}))}})),s.addEventListener("submit",(e=>{if(e.preventDefault(),s.dataset.edit){const e={name:`${r.value}`,email:`${n.value}`,children:c.checked,permission:d};userService.editUser(s.dataset.edit,e).then((()=>{userService.usersGet().then((e=>t(e)))})),s.reset(),i.value=""}}))})(),(()=>{const e=document.querySelector(".btn-group"),s=document.getElementById("search-input");e.addEventListener("click",(e=>{e.target.closest("#btn-isChildren")&&userService.filterUsers("?children=true").then((e=>t(e))),e.target.closest("#btn-isPermissions")&&userService.filterUsers("?permission=true").then((e=>t(e))),e.target.closest("#btn-isAll")&&(userService.usersGet().then((e=>t(e))),s.value="")}))})(),(()=>{const e=document.getElementById("sort-is-children");let s=!0;e.style.cursor="pointer",e.addEventListener("click",(()=>{s=!s,userService.sortUsers("?_sort=children&_order="+(s?"desc":"asc")).then((e=>t(e)))}))})(),(()=>{const e=document.getElementById("search-input"),s=((e,t=300)=>{let s;return(...r)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(void 0,r)}),t)}})((()=>{userService.searchUsers(`?name_like=${e.value}`).then((e=>t(e)))}),400);e.addEventListener("input",s)})()})();